<!DOCTYPE html>
<html>
  <head>
    <title>SlackDeck-Proto</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>

    <div class="small-tab">
      <div class="webview">
        <webview id="full-contents" src="about:blank" />
      </div>
    </div>

    <div class="middle-tab">
      <div class="webview">
        <webview id="no-channel-contents" src="about:blank" />
      </div>
    </div>

    <div class="middle-tab">
      <div class="webview">
        <webview id="no-channel-contents" src="about:blank" />
      </div>
    </div>

    <div class="middle-tab">
      <div class="webview">
        <webview id="no-channel-contents" src="about:blank" />
      </div>
    </div>

    <div class="small-tab">
      <div class="webview">
        <webview id="full-contents" src="about:blank" />
      </div>
    </div>

    <script>
      const json = require('./settings.json');
      const css = ".client_channels_list_container { display: none !important; }";
      const webviews = Array.from(document.getElementsByTagName("webview"));

      webviews.forEach(function(webview, index) {
          webview.addEventListener('dom-ready', function() {
              if (checkUrlIsDefault(webview)) {
                  const channel = json.channels[index];
                  const channelUrl = setChannelUrl(json.url, channel);
                  loadURL(webview, channelUrl);
              }
              if (!shouldkRenderFullContents(webview)) { applyCss(webview, css); }
          });
      });

      function setChannelUrl(baseUrl, channel) {
          const url = "messages/" + channel;
          return new URL(url, baseUrl).href.toString();
      }
      function shouldkRenderFullContents(webview) {
          return webview.id == "full-contents";
      }
      function checkUrlIsDefault(webview) {
          return webview.attributes.src.value == "about:blank";
      }
      function loadURL(webview, url) {
          webview.loadURL(url.toString());
      }
      function applyCss(webview, css) {
          webview.insertCSS(css);
      }
    </script>

  </body>
</html>
